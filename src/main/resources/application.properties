# Application Configuration
spring.application.name=tiling-be
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}

# Database Configuration
# Railway provides either:
# 1. Full MYSQL_URL connection string (preferred if available)
# 2. Individual variables: MYSQLHOST, MYSQLPORT, MYSQLUSER, MYSQLPASSWORD, MYSQLDATABASE
# If MYSQL_URL is provided, use it directly; otherwise construct from individual components
# Railway MySQL may require SSL - set MYSQL_USE_SSL=true for Railway
spring.datasource.url=${MYSQL_URL:jdbc:mysql://${MYSQLHOST:localhost}:${MYSQLPORT:3306}/${MYSQLDATABASE:tiling}?useSSL=${MYSQL_USE_SSL:false}&requireSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&connectTimeout=10000&socketTimeout=30000}
spring.datasource.username=${MYSQLUSER:root}
spring.datasource.password=${MYSQLPASSWORD:ChogyalWp}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
# HikariCP Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.initialization-fail-timeout=-1

# JPA Configuration
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# Flyway Migration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration/mysql
spring.flyway.baseline-on-migrate=true

# File Upload Configuration
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.resolve-lazily=false

# Mail Configuration
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=3000
spring.mail.properties.mail.smtp.writetimeout=5000

# Application-specific Configuration
# File Storage
app.file-storage.upload-dir=${FILE_UPLOAD_DIR:./uploads}
app.file-storage.allowed-types=image/jpeg,image/png,image/gif,image/webp,application/pdf
app.file-storage.max-file-size=10485760

# UploadThing Configuration
# IMPORTANT: You need BOTH the API secret AND App ID from your UploadThing dashboard
# 1. Go to https://uploadthing.com/dashboard
# 2. Select your app
# 3. Copy the API Key (starts with sk_live_ or sk_test_)
# 4. Copy the App ID from the URL: https://uploadthing.com/dashboard/{APP_ID}/...
uploadthing.api.base-url=https://api.uploadthing.com/v5
uploadthing.api.secret=${UPLOADTHING_API_SECRET:}
uploadthing.api.app-id=${UPLOADTHING_APP_ID:mj2duw9tdo}
uploadthing.api.timeout=30s
uploadthing.api.retry.max-attempts=3
uploadthing.api.retry.backoff-delay=1s
uploadthing.script.upload=uploadthing-upload.js
uploadthing.script.delete=uploadthing-delete.js
uploadthing.script.timeout=60

# UploadThing Node.js Service Configuration
# URL of the Node.js microservice that wraps UploadThing SDK
# For Railway: Set APP_UPLOADTHING_SERVICE_URL environment variable to your Node.js service URL
# Example: https://uploadthing-service-production.up.railway.app
app.uploadthing.service-url=${APP_UPLOADTHING_SERVICE_URL:http://localhost:3001}
app.uploadthing.enabled=true

# Admin Email
app.admin.email=${ADMIN_EMAIL:admin@tilingroofing.com.au}

# Booking Configuration
app.booking.ref-prefix=TR

# JWT Configuration
# Token expiration in milliseconds (default: 3600000 = 1 hour)
# Can be overridden via JWT_EXPIRATION environment variable
app.jwt.secret=${JWT_SECRET:dev-jwt-secret-key-change-in-production-minimum-256-bits-required-for-security}
app.jwt.expiration=${JWT_EXPIRATION:3600000}

# CORS Configuration
app.cors.allowed-origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:5173,https://tiling-fe.vercel.app}
app.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true
app.cors.max-age=3600

# Server Configuration
# Railway uses PORT environment variable, so check for it first
server.port=${PORT:${SERVER_PORT:8082}}
server.error.include-message=always
server.error.include-binding-errors=always

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when_authorized

# OpenAPI Documentation
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha

